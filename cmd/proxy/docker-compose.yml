version: '2'

services:
  atomfeedpub:
    image: xtracdev/atompub
    ports:
      - "4000:8000"
    environment:
      - LINKHOST=${LINKHOST}
      - LISTENADDR=${LISTENADDR}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_HOST=${DB_HOST}
      - DB_PORT=${DB_PORT}
      - DB_SVC=${DB_SVC}
      - PRIVATE_KEY=${PRIVATE_KEY}
      - CERTIFICATE=${CERTIFICATE}
      - CACERT=${CACERT}
    volumes:
      - ./atompubcerts:/certs
    logging:
      driver: syslog
    depends_on:
      - "sumo"

  nginxproxy:
    image: xtracdev/nginxproxy
    volumes:
      - ./rp.conf:/etc/nginx/nginx.conf
      - ./nginx-certs:/tmp/certs
    ports:
      - "5000:5000"
    logging:
      driver: syslog
    depends_on:
      - "sumo"
      - "atomfeedpub"

  sumo:
    image: sumologic/collector:latest-logging-driver-syslog
    volumes:
      - /var/log/syslog:/syslog
    environment:
      - SUMO_PROXY_HOST=${SUMO_PROXY_HOST}
      - SUMO_PROXY_PORT=${SUMO_PROXY_PORT}
      - SUMO_COLLECTOR_NAME=${SUMO_COLLECTOR_NAME}
      - SUMO_ACCESS_ID=${SUMO_ACCESS_ID}
      - SUMO_ACCESS_KEY=${SUMO_ACCESS_KEY}
